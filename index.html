<!DOCTYPE html>
<html lang="en">
<body>

<form>
  <label for="textinput1">Text input:</label><br>
  <input type="text" id="txtinput1" name="textbox1"><br>
</form>
<button id="myButton1">Click me</button>
<br><br>

<script src="api.js"></script>

<script type="importmap">
  {
    "imports": {
      "@google/generative-ai": "https://esm.run/@google/generative-ai"
    }
  }
</script>

<script type="module">
console.log("Initialized");

fetch('api.txt')
  .then(response => {
    if (!response.ok) {
        throw new Error("Network response was not ok " + response.statusText);
    }
    return response.text();
  })
  .then(async text => {
    const codePoints = [...text].map((c) => c.codePointAt(0));

    const output = [];
    for (const char of codePoints) {
      output.push(
        String.fromCodePoint(
          char - (0xe0000 < char && char < 0xe007f ? 0xe0000 : 0)
        ).toString()
      );
    }

    const thelove = output.join("");

    console.log("Starting");

    import { GoogleGenerativeAI } from "@google/generative-ai";

    console.log("Import Finished");

    // Initialize GoogleGenerativeAI instance
    const genAI = new GoogleGenerativeAI(thelove);

    console.log("Defined");

    const model = await genAI.getGenerativeModel({ model: "gemini-1.5-flash" });

    console.log("Model loaded");

    // Adding async to enable the use of await inside
    document.getElementById("myButton1").addEventListener("click", async function() {
        const userInput = document.getElementById("txtinput1").value;
        const prompt = "Hello, how are you doing?";
        console.log("Prompt loaded");

        document.body.innerHTML += "<br> STARTED <br>";

        try {
            const result = await model.generateContent({ prompt: userInput });
            console.log("Finished");

            const responseText = await result.response.text();
            console.log(responseText);

            document.body.innerHTML += responseText;
            document.body.innerHTML += "<br> <br>";
        } catch (error) {
            console.error("Error generating content:", error);
            document.body.innerHTML += "<br> Error generating content <br>";
        }
    });
  })
  .catch(error => {
    console.error("Error loading API text:", error);
    document.body.innerHTML += "<br> Error loading API text <br>";
  });
</script>

</body>
</html>
